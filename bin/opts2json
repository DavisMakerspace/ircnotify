#!/usr/bin/env ruby
require 'json'
cmds = {nil=>[]}
cmd = nil
ARGV.each do |arg|
  if arg.start_with? '--'
    cmd = arg[2..-1].tr '-','_'
    cmds[cmd] = [] if not cmds[cmd]
  else
    j = JSON.parse arg rescue nil
    arg = j.is_a?(Hash) ? j : (Integer(arg) rescue nil || Float(arg) rescue nil || arg)
    cmds[cmd] << arg
  end
end
cmds.delete nil if cmds[nil] == []
cmds.each do |key, value|
  cmds[key] = nil if value.size == 0
  cmds[key] = value[0] if value.size == 1
end
cmds = Array(cmds[nil]) if cmds.size == 1
puts cmds.to_json
